作業中


# E2E サンプル実装

## Description

題材は「オンラインショップ」をテーマでPlaywright + Gherkinで実装した。

フロントエンド、バックエンド、End to End(E2E)、データベースなどある程度全部揃った状態で用意してある。

オンラインショップの実装は最小限で、商品を選び、カートに入れて、決済して購入できる、までとする。

## Motivation

End To End(E2E)テストでGherkinを取り入れるとどのようにいいことがあるかを説明するために作られたリポジトリです。

E2Eを作ると起こる良いこと

1. 品質が上がる

トップダウン形式でシナリオを作ることで、プロダクトの仕様やユースケースを説明を書くことで理解が深まる。

このシナリオを作る工程でプロダクトにさらに精通することができ、プロダクトの問題点(UIや仕様の漏れの発見などなど)を洗い出すことができる。

仕様を理解することで、例えば新機能開発で考慮漏れを防ぐことや障害が起きた時にこういったケースを考慮していなかったことの説明に使うこともできる。

また、プロダクトに精通している開発者が増えることで生産性も向上し良い循環が生まれる。

他には、ソースコードは定期的にリファクタリングをする必要があるが、E2Eを用意することでリファクタリング前後でデグレ確認も容易になる。

UX向上は現在のシステム開発においてとても重要なものになっている。そこでE2Eに取り組むことが顧客のUX向上、開発体験向上、に貢献しみんなハッピーになれる。


2. 教育

シナリオを読むことで新規メンバーが仕様を早く理解してキャッチアップすることができ、即戦力として活躍できる

3. プロダクトの価値を上げる

E2Eが根付いたプロジェクトでは、ソフトウェアテストのサイクルが速くなることで市場に新しい機能を素早く提供しUX向上に繋げることができる。

日時やMRを作成する度に、E2Eを実施することでデグレ確認ができるし開発と保守にかかる総コストを下げることができる。

E2Eでプロファイルを作成することで、カバレッジやAPIのレスポンスが遅くなっていないかなどチェックし


良いことばかりではない、E2Eをやるのに苦労すること・デメリット

1. 時間がかかる

システムテストがあるからやらなくてもいい、小さなシステムだからそんな大層なことをやらなくても、、、と思われがち。

そして、作るのはとても時間がかかる。まず、シナリオを整理するのが大変な作業になる。

しかし、Gherkin(後述にもある)という仕様を使い、シナリオからテストコードの雛形を作ってくれる素晴らしい規格(仕組み)が存在する。

このGherkinで整理すること自体が大変ではあるかもしれないが、プロダクトのユースケースを言語化してテストコードを作ってくれるようになるとなぜだかこの作業が楽しくなってくる。

プロダクトを作っている開発者でさえ気づかなかったパターンや考慮漏れに気づき、だんだんと完成形に近づいていく工程は病みつきになる(個人談)。

このリポジトリはPMに`E2Eをやるとこういういいことがある`と説得するために用意されたものです。なんとか、E2Eに取り組むための時間を確保してもらえないかお願いしてみてください。

2. あらゆるパターンをテスト自動化すること、はできない

銀の弾丸はないです。E2Eでも再現できないシナリオが存在するでしょう。

E2Eに取り組む時の姿勢のひとつに`完璧を求めない`があります。特に初期段階で完璧を求めてしまうと挫折するし、いつまで経っても完成することはないです。

E2Eに終わりはありません。しかし、始めることに大きな意義はあります。

3. 忙しくて後回しになりがち

コード、プロダクト、人、企業文化、あらゆるものが変化して行きます。E2Eは**素早さ**と**思いっきり**が大事です。

初期段階では、全てのパターンを網羅するより、今思いつくユースケースを考え抜き書き出すことから始めると良いでしょう。

大体できてきたなと思ったらテストコードを生成し、自動テストの実装に取り掛かってください。ボタンをクリックするがわからなくて苦労するかもしれないが、大抵はドキュメントに解決策が書かれています。

徐々にユースケースを足していきましょう。何度も言いますがいきなりデカくやろうとすると挫折します。**1日30分だけ取り組む**などをスクラムで話し合って取り組むなどしてください。

3ヶ月くらい取り組んでE2Eを書きCIに組み込んで開発する習慣ができてきたら、パターンの網羅に取り組みましょう。

成長期(E2Eに抵抗がなくなり文化の一部として馴染みE2Eを活用していこうと思えるころ)になると、E2Eを使ってソースコードのリファクタリングを始めたり、初期のテストコードを捨てて新しくテストFixtureを使って効率的に自動テストコードを書く、といったことに挑戦しだすことでしょう。

成熟期になると、スマホやPCのデザインを確認したり、MRで画像で差分を確認したり、高度な使い方を検討し始めて

ここまでくるとE2Eがなかったころに戻れなくなるはずです。

まずは**小さく始めることに集中し、慣れてきたらだんだんユースケースの洗い出しとテストコードを徐々に増やしていく**を激しくお勧めします。

## Stack

作成時点で最新のバージョンで実装する

Frontend
- Next.js (v14.2 https://nextjs.org/blog/next-14-2)
- TypeScript

End To End(E2E)
- Playwright
- Cucumber

Backend(オンラインショップ)
- Elixir/Phoenix
- PostgreSQL

Backend(架空のクレジットカード会社)
- Go/Gin

メモ: 本当はKubernetes上で簡単にデプロイして〜を考えていたが、どなたでも利用できるようにHTTPサーバをローカルで経てて再現できる方針にしました

## Port

|port|app|
|:---:|:---|
|48800|Frontend|
|48801|Backend Online Shop Server|
|48802|Database|
|48803|Credit System|

## Relation

<< Gherkin -> Cucumber -> playwright test の流れをmermaidで書く >>

```marmaid
```

## References

Gherkin
- https://cucumber.io/docs/gherkin/reference/

Cucumber homepage
- https://cucumber.io/docs/cucumber/

